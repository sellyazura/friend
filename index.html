<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Friendship Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-pink-400 to-purple-600 text-white transition-all">
    <div class="max-w-2xl mx-auto p-6 bg-white dark:bg-gray-900 rounded-lg shadow-2xl mt-10 text-gray-900 dark:text-white">
        <h1 class="text-4xl font-bold text-center mb-6">üí¨ Admin Arisan</h1>
        
        <div id="registerSection" class="text-center">
            <input id="username" type="text" placeholder="Masukkan Nama Anda" class="mt-4 px-4 py-2 w-full border rounded shadow">
            <input id="profilePic" type="file" accept="image/*" class="mt-2 px-4 py-2 w-full border rounded">
            <button onclick="registerUser()" class="mt-2 px-4 py-2 bg-pink-500 text-white rounded hover:bg-pink-600 w-full">Gabung</button>
        </div>
        
        <div id="mainContent" class="hidden">
            <div class="flex items-center space-x-4 mb-4">
                <img id="userAvatar" class="w-16 h-16 rounded-full hidden border-2 border-pink-500" alt="Profile Picture">
                <p id="welcomeMessage" class="text-xl font-semibold"></p>
                <span id="status" class="text-sm text-green-500">üü¢ Online</span>
                <button onclick="logout()" class="ml-auto px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600">Keluar</button>
            </div>
            
            <h2 class="text-2xl font-semibold">üë• Anggota Online</h2>
            <ul id="onlineUsers" class="mt-2 bg-gray-200 dark:bg-gray-700 p-4 rounded grid grid-cols-2 gap-4"></ul>
            
            <h2 class="text-2xl font-semibold mt-6">üó£Ô∏è Chat Room</h2>
            <div id="chatRoom" class="border p-4 rounded mt-2 bg-gray-200 dark:bg-gray-700 h-48 overflow-y-auto"></div>
            <input id="chatInput" type="text" placeholder="Ketik pesan..." class="mt-2 px-4 py-2 w-full border rounded shadow">
            <button onclick="sendChat()" class="mt-2 px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 w-full">Kirim</button>
        </div>
    </div>

    <script>
        let username = localStorage.getItem("username") || "";
        let profilePicUrl = localStorage.getItem("profilePic") || "";
        let onlineUsers = JSON.parse(localStorage.getItem("onlineUsers")) || [];
        let chatMessages = JSON.parse(localStorage.getItem("chatMessages")) || [];

        function registerUser() {
            let inputName = document.getElementById("username").value;
            let profilePic = document.getElementById("profilePic").files[0];
            
            if(inputName.trim() !== "") {
                username = inputName;
                localStorage.setItem("username", username);
                document.getElementById("welcomeMessage").textContent = "Halo, " + username;
                
                if(profilePic) {
                    let reader = new FileReader();
                    reader.onload = function(e) {
                        profilePicUrl = e.target.result;
                        localStorage.setItem("profilePic", profilePicUrl);
                        document.getElementById("userAvatar").src = profilePicUrl;
                        document.getElementById("userAvatar").classList.remove("hidden");
                        addOnlineUser(username, profilePicUrl);
                    };
                    reader.readAsDataURL(profilePic);
                } else {
                    addOnlineUser(username, profilePicUrl);
                }
                
                document.getElementById("registerSection").classList.add("hidden");
                document.getElementById("mainContent").classList.remove("hidden");
            }
        }

        function addOnlineUser(name, profile) {
            let userExists = onlineUsers.some(user => user.name === name);
            if (!userExists) {
                onlineUsers.push({ name, profile, status: "üü¢ Online" });
                localStorage.setItem("onlineUsers", JSON.stringify(onlineUsers));
            }
            updateOnlineUsers();
        }

        function sendChat() {
            let chat = document.getElementById("chatInput").value;
            if(chat.trim() !== "") {
                let message = { username, profilePicUrl, chat };
                chatMessages.push(message);
                localStorage.setItem("chatMessages", JSON.stringify(chatMessages));
                displayChatMessages();
                document.getElementById("chatInput").value = "";
            }
        }

        function displayChatMessages() {
            let chatRoom = document.getElementById("chatRoom");
            chatRoom.innerHTML = "";
            chatMessages.forEach(message => {
                chatRoom.innerHTML += `
                    <div class='flex items-center space-x-2 mt-2'>
                        <img src='${message.profilePicUrl}' class='w-8 h-8 rounded-full border-2 border-gray-400'>
                        <p><strong>${message.username}:</strong> ${message.chat}</p>
                    </div>`;
            });
        }

        function updateOnlineUsers() {
            let list = document.getElementById("onlineUsers");
            list.innerHTML = "";
            onlineUsers.forEach(user => {
                list.innerHTML += `
                    <li class='flex items-center space-x-2 bg-gray-100 dark:bg-gray-800 p-2 rounded shadow'>
                        <img src='${user.profile}' class='w-8 h-8 rounded-full border-2 border-green-500'>
                        <span>${user.name} ${user.status}</span>
                    </li>`;
            });
        }

        function logout() {
            onlineUsers = onlineUsers.filter(user => user.name !== username);
            localStorage.setItem("onlineUsers", JSON.stringify(onlineUsers));
            localStorage.removeItem("username");
            localStorage.removeItem("profilePic");
            document.getElementById("mainContent").classList.add("hidden");
            document.getElementById("registerSection").classList.remove("hidden");
            updateOnlineUsers();
        }

        function loadUserData() {
            if (username) {
                document.getElementById("welcomeMessage").textContent = "Halo, " + username;
                document.getElementById("registerSection").classList.add("hidden");
                document.getElementById("mainContent").classList.remove("hidden");
            }
            updateOnlineUsers();
            displayChatMessages();
        }

        document.getElementById("chatInput").addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                sendChat();
            }
        });

        loadUserData();
    </script>
</body>
</html>
